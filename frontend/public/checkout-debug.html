<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout Debug - ×©×•×œ× ×”×©×›×¨×ª ×¦×™×•×“</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      direction: rtl;
    }
    .debug-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
    }
    .test-section h3 {
      color: #1f2937;
      margin-bottom: 15px;
    }
    .test-button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }
    .test-button:hover {
      background: #2563eb;
    }
    .results {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 15px;
      margin-top: 10px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-left: 8px;
    }
    .status-success { background: #10b981; }
    .status-error { background: #ef4444; }
    .status-warning { background: #f59e0b; }
    .icon-test {
      width: 24px;
      height: 24px;
      margin: 5px;
      border: 1px solid #ccc;
      display: inline-block;
    }
  </style>
</head>
<body>
  <div class="debug-container">
    <h1>ğŸ§ª Checkout Debug Tool - ×›×œ×™ ×‘×“×™×§×ª ×ª×”×œ×™×š ×”×–×× ×”</h1>
    <p>×›×œ×™ ×–×” ×‘×•×“×§ ××ª ×ª×§×™× ×•×ª ×ª×”×œ×™×š ×”×”×–×× ×” ×•××–×”×” ×‘×¢×™×•×ª ××¤×©×¨×™×•×ª</p>

    <div class="test-section">
      <h3>ğŸ“¡ ×‘×“×™×§×ª ×—×™×‘×•×¨ API</h3>
      <button class="test-button" onclick="testApiConnection()">×‘×“×•×§ ×—×™×‘×•×¨ ×œ×©×¨×ª</button>
      <button class="test-button" onclick="testProductsAPI()">×‘×“×•×§ API ××•×¦×¨×™×</button>
      <div id="api-results" class="results"></div>
    </div>

    <div class="test-section">
      <h3>ğŸ¨ ×‘×“×™×§×ª ×’×“×œ×™ ××™×™×§×•× ×™×</h3>
      <p>×‘×“×™×§×” ×”×× ×”××™×™×§×•× ×™× ××•×¦×’×™× ×‘×’×“×œ×™× × ×›×•× ×™×:</p>
      <div>
        Header Icon (24px): <svg class="icon-test" style="width: 24px; height: 24px;" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/></svg>
        Section Icon (20px): <svg class="icon-test" style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/></svg>
        Status Icon (16px): <svg class="icon-test" style="width: 16px; height: 16px;" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/></svg>
        Item Icon (14px): <svg class="icon-test" style="width: 14px; height: 14px;" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/></svg>
      </div>
      <button class="test-button" onclick="testIconSizes()">×‘×“×•×§ ×’×“×œ×™ ××™×™×§×•× ×™× ×‘×¢××•×“</button>
      <div id="icon-results" class="results"></div>
    </div>

    <div class="test-section">
      <h3>ğŸ“‹ ×‘×“×™×§×ª ××‘× ×” × ×ª×•× ×™×</h3>
      <button class="test-button" onclick="testCheckoutDataStructure()">×‘×“×•×§ ××‘× ×” × ×ª×•× ×™ ×”×–×× ×”</button>
      <button class="test-button" onclick="testAddressResolution()">×‘×“×•×§ ×¤×ª×¨×•×Ÿ ×›×ª×•×‘×•×ª</button>
      <div id="data-results" class="results"></div>
    </div>

    <div class="test-section">
      <h3>âš¡ ×‘×“×™×§×ª ×–××™× ×•×ª</h3>
      <button class="test-button" onclick="testAvailabilityTimeout()">×‘×“×•×§ timeout ×–××™× ×•×ª</button>
      <button class="test-button" onclick="simulateWebSocketConnection()">×¡×™××•×œ×¦×™×” WebSocket</button>
      <div id="availability-results" class="results"></div>
    </div>

    <div class="test-section">
      <h3>ğŸš€ ×‘×“×™×§×” ××§×™×¤×”</h3>
      <button class="test-button" onclick="runAllTests()">×”×¨×¥ ××ª ×›×œ ×”×‘×“×™×§×•×ª</button>
      <div id="all-results" class="results"></div>
    </div>
  </div>

  <script>
    let results = {};

    function log(section, message, status = 'info') {
      const element = document.getElementById(`${section}-results`);
      if (element) {
        const timestamp = new Date().toLocaleTimeString('he-IL');
        const statusIcon = status === 'success' ? 'âœ…' : status === 'error' ? 'âŒ' : status === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
        element.textContent += `[${timestamp}] ${statusIcon} ${message}\n`;
        element.scrollTop = element.scrollHeight;
      }
      results[section] = results[section] || [];
      results[section].push({ message, status, timestamp });
    }

    async function testApiConnection() {
      log('api', '×‘×•×“×§ ×—×™×‘×•×¨ ×œ×©×¨×ª...', 'info');
      
      try {
        const response = await fetch('http://localhost:5002/api/products?limit=1');
        if (response.ok) {
          log('api', '×—×™×‘×•×¨ ×œ×©×¨×ª ×ª×§×™×Ÿ âœ…', 'success');
          const data = await response.json();
          log('api', `× ××¦××• ${data.products.length} ××•×¦×¨×™×`, 'success');
        } else {
          log('api', `×©×¨×ª ×”×—×–×™×¨ ×§×•×“ ×©×’×™××”: ${response.status}`, 'error');
        }
      } catch (error) {
        log('api', `×©×’×™××ª ×—×™×‘×•×¨: ${error.message}`, 'error');
      }
    }

    async function testProductsAPI() {
      log('api', '×‘×•×“×§ API ××•×¦×¨×™×...', 'info');
      
      try {
        const response = await fetch('http://localhost:5002/api/products');
        const data = await response.json();
        
        log('api', `×¡×”"×› ××•×¦×¨×™×: ${data.products.length}`, 'info');
        log('api', `×“×¤×™×: ${data.pagination.totalPages}`, 'info');
        log('api', `×§×˜×’×•×¨×™×•×ª: ${data.filters.categories.join(', ')}`, 'info');
        
        if (data.products.length > 0) {
          const product = data.products[0];
          log('api', `××•×¦×¨ ×œ×“×•×’××”: ${product.name} - ${product.price}â‚ª`, 'success');
        }
      } catch (error) {
        log('api', `×©×’×™××” ×‘×˜×¢×™× ×ª ××•×¦×¨×™×: ${error.message}`, 'error');
      }
    }

    function testIconSizes() {
      log('icon', '×‘×•×“×§ ×’×“×œ×™ ××™×™×§×•× ×™× ×‘×¢××•×“...', 'info');
      
      const svgElements = document.querySelectorAll('svg');
      let oversizedIcons = 0;
      let totalIcons = svgElements.length;
      
      svgElements.forEach((svg, index) => {
        const rect = svg.getBoundingClientRect();
        const width = rect.width;
        const height = rect.height;
        
        if (width > 32 || height > 32) {
          oversizedIcons++;
          log('icon', `××™×™×§×•×Ÿ ×’×“×•×œ ××“×™ #${index}: ${width}x${height}px`, 'warning');
        }
      });
      
      log('icon', `× ××¦××• ${totalIcons} ××™×™×§×•× ×™×, ${oversizedIcons} ×’×“×•×œ×™× ××“×™`, oversizedIcons > 0 ? 'warning' : 'success');
    }

    function testCheckoutDataStructure() {
      log('data', '×‘×•×“×§ ××‘× ×” × ×ª×•× ×™ ×”×–×× ×”...', 'info');
      
      const mockCheckoutData = {
        customerInfo: {
          firstName: "Test",
          lastName: "User",
          email: "test@example.com",
          phone: "0501234567",
          idNumber: ""
        },
        pickupReturn: {
          pickupAddress: "main_store",
          pickupDate: new Date(),
          pickupTime: "17:00",
          returnAddress: "main_store",
          returnDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000),
          returnTime: "19:00"
        },
        contract: {
          signed: false,
          signatureData: null
        },
        idUpload: {
          uploaded: false,
          fileName: ""
        }
      };
      
      // Test data completeness
      const hasCustomerInfo = mockCheckoutData.customerInfo.firstName && 
                             mockCheckoutData.customerInfo.lastName && 
                             mockCheckoutData.customerInfo.email && 
                             mockCheckoutData.customerInfo.phone;
      
      const hasPickupReturn = mockCheckoutData.pickupReturn.pickupAddress && 
                             mockCheckoutData.pickupReturn.pickupDate && 
                             mockCheckoutData.pickupReturn.returnDate;
      
      log('data', `×¤×¨×˜×™ ×œ×§×•×—: ${hasCustomerInfo ? 'âœ…' : 'âŒ'}`, hasCustomerInfo ? 'success' : 'error');
      log('data', `××™×¡×•×£ ×•×”×—×–×¨×”: ${hasPickupReturn ? 'âœ…' : 'âŒ'}`, hasPickupReturn ? 'success' : 'error');
      log('data', `×—×ª×™××” ×¢×œ ×”×¡×›×: ${mockCheckoutData.contract.signed ? 'âœ…' : 'â³'}`, mockCheckoutData.contract.signed ? 'success' : 'warning');
      log('data', `×”×¢×œ××ª ×ª×¢×•×“×ª ×–×”×•×ª: ${mockCheckoutData.idUpload.uploaded ? 'âœ…' : 'â³'}`, mockCheckoutData.idUpload.uploaded ? 'success' : 'warning');
    }

    function testAddressResolution() {
      log('data', '×‘×•×“×§ ×¤×ª×¨×•×Ÿ ×›×ª×•×‘×•×ª...', 'info');
      
      const pickupLocations = [
        {
          id: "main_store",
          name: "×”×—× ×•×ª ×”×¨××©×™×ª",
          address: "×¨×—×•×‘ ×”×¨×¦×œ 123, ×ª×œ ××‘×™×‘"
        },
        {
          id: "legacy_haifa",
          name: "×¡× ×™×£ ×—×™×¤×”",
          address: "×˜×‘×¨×™×” 15, ×—×™×¤×”"
        }
      ];
      
      const testAddresses = ["main_store", "legacy_haifa", "×˜×‘×¨×™×” 15, ×—×™×¤×”", "unknown_location"];
      
      testAddresses.forEach(address => {
        const location = pickupLocations.find(loc => loc.id === address || loc.address === address);
        if (location) {
          log('data', `×›×ª×•×‘×ª "${address}" -> ${location.name}: ${location.address}`, 'success');
        } else {
          log('data', `×›×ª×•×‘×ª "${address}" -> ×œ× × ××¦××”`, 'warning');
        }
      });
    }

    function testAvailabilityTimeout() {
      log('availability', '×‘×•×“×§ timeout ×‘×“×™×§×ª ×–××™× ×•×ª...', 'info');
      
      let timeoutTest = setTimeout(() => {
        log('availability', 'Timeout ×¤×•×¢×œ ×›×”×œ×›×” - 5 ×©× ×™×•×ª', 'success');
      }, 5000);
      
      log('availability', '××ª×—×™×œ ×¡×¤×™×¨×” ×œ××—×•×¨ ×©×œ 5 ×©× ×™×•×ª...', 'info');
      
      // Simulate clearing timeout (like fixing infinite loading)
      setTimeout(() => {
        clearTimeout(timeoutTest);
        log('availability', 'Timeout ×‘×•×˜×œ ×‘×”×¦×œ×—×” - ××•× ×¢ ×˜×¢×™× ×” ××™× ×¡×•×¤×™×ª', 'success');
      }, 2000);
    }

    function simulateWebSocketConnection() {
      log('availability', '××“××” ×—×™×‘×•×¨ WebSocket...', 'info');
      
      // Simulate connection states
      setTimeout(() => log('availability', '××ª×—×‘×¨...', 'info'), 500);
      setTimeout(() => log('availability', '××—×•×‘×¨ âœ…', 'success'), 1000);
      setTimeout(() => log('availability', '×‘×•×“×§ ×–××™× ×•×ª ××•×¦×¨×™×...', 'info'), 1500);
      setTimeout(() => log('availability', '×›×œ ×”××•×¦×¨×™× ×–××™× ×™× âœ…', 'success'), 2500);
    }

    async function runAllTests() {
      log('all', '××ª×—×™×œ ×‘×“×™×§×” ××§×™×¤×”...', 'info');
      
      await testApiConnection();
      await testProductsAPI();
      testIconSizes();
      testCheckoutDataStructure();
      testAddressResolution();
      testAvailabilityTimeout();
      simulateWebSocketConnection();
      
      setTimeout(() => {
        log('all', '=== ×¡×™×›×•× ×‘×“×™×§×” ××§×™×¤×” ===', 'info');
        
        let totalTests = 0;
        let passedTests = 0;
        let issues = [];
        
        Object.keys(results).forEach(section => {
          const sectionResults = results[section];
          const sectionPassed = sectionResults.filter(r => r.status === 'success').length;
          const sectionTotal = sectionResults.length;
          totalTests += sectionTotal;
          passedTests += sectionPassed;
          
          if (sectionPassed < sectionTotal) {
            const sectionIssues = sectionResults.filter(r => r.status === 'error' || r.status === 'warning');
            issues.push(`${section}: ${sectionIssues.length} ×‘×¢×™×•×ª`);
          }
        });
        
        log('all', `×¡×”"×› ×‘×“×™×§×•×ª: ${totalTests}, ×¢×‘×¨×•: ${passedTests}`, passedTests === totalTests ? 'success' : 'warning');
        
        if (issues.length > 0) {
          log('all', `×‘×¢×™×•×ª ×©×–×•×”×•: ${issues.join(', ')}`, 'warning');
        } else {
          log('all', '×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×• ×‘×”×¦×œ×—×”! ğŸ‰', 'success');
        }
      }, 3000);
    }

    // Auto-run basic tests on page load
    window.addEventListener('load', () => {
      log('all', '×¢××•×“ ×”×‘×“×™×§×” × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”', 'success');
      setTimeout(testApiConnection, 1000);
    });
  </script>
</body>
</html> 